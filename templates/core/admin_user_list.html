{% extends "base.html" %}

{% block content %}
<div class="v-container">
    <div class="v-section" style="max-width: 1200px; margin: 0 auto;">
        <div class="v-section-header">
            <div>
                <h1 class="v-section-title">User Management</h1>
                <p style="color: var(--text-secondary); margin: 0;">Total registered members: {{ user_count }} ({{
                    uploader_count }} Uploaders)</p>
            </div>
            <div style="display: flex; gap: 12px;">
                <a href="{% url 'admin_dashboard' %}" class="v-btn v-btn-secondary">Back to Dashboard</a>
            </div>
        </div>

        <div
            style="background: var(--card-bg); border-radius: var(--card-radius); border: 1px solid var(--border-color); overflow: hidden; box-shadow: var(--shadow-md);">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: var(--bg-color); border-bottom: 2px solid var(--border-color);">
                    <tr>
                        <th
                            style="text-align: left; padding: 16px 24px; font-size: 13px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase;">
                            User</th>
                        <th
                            style="text-align: left; padding: 16px 24px; font-size: 13px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase;">
                            Contact Info</th>
                        <th
                            style="text-align: center; padding: 16px 24px; font-size: 13px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase;">
                            Role</th>
                        <th
                            style="text-align: center; padding: 16px 24px; font-size: 13px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase;">
                            Status</th>
                        <th
                            style="text-align: right; padding: 16px 24px; font-size: 13px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase;">
                            Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr style="border-bottom: 1.5px solid var(--border-color); transition: background 0.2s;"
                        class="user-row">
                        <td style="padding: 18px 24px;">
                            <a href="{% url 'user_profile' u.username %}"
                                style="text-decoration: none; color: var(--text-primary); display: flex; align-items: center; gap: 12px;">
                                <div
                                    style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: var(--bg-color); border: 1px solid var(--border-color);">
                                    {% if u.profile_picture %}
                                    <img src="{{ u.profile_picture.url }}"
                                        style="width: 100%; height: 100%; object-fit: cover;">
                                    {% else %}
                                    <div
                                        style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--accent-color); color: white; font-weight: 800;">
                                        {{ u.username|first|upper }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div>
                                    <p style="margin: 0; font-weight: 700;">{{ u.username }}</p>
                                    <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Joined {{
                                        u.date_joined|date:"M d, Y" }}</p>
                                </div>
                            </a>
                        </td>
                        <td style="padding: 18px 24px;">
                            <p style="margin: 0; font-size: 14px; font-weight: 600;">{{ u.email }}</p>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">{{
                                u.phone_number|default:"No phone" }}</p>
                        </td>
                        <td style="padding: 18px 24px; text-align: center;">
                            {% if u.is_superuser %}
                            <span
                                style="background: rgba(91, 95, 199, 0.1); color: var(--accent-color); padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase;">Admin</span>
                            {% elif u.is_uploader %}
                            <span
                                style="background: rgba(104, 211, 145, 0.1); color: #38A169; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase;">Uploader</span>
                            {% else %}
                            <span
                                style="background: var(--bg-color); color: var(--text-secondary); padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase;">User</span>
                            {% endif %}
                        </td>
                        <td style="padding: 18px 24px; text-align: center;">
                            {% if u.is_active %}
                            <span
                                style="display: inline-flex; align-items: center; gap: 4px; color: #38A169; font-size: 13px; font-weight: 700;">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: #38A169;"></span>
                                Active
                            </span>
                            {% else %}
                            <span
                                style="display: inline-flex; align-items: center; gap: 4px; color: var(--text-secondary); font-size: 13px; font-weight: 700;">
                                <span style="width: 8px; height: 8px; border-radius: 50%; background: #CBD5E0;"></span>
                                Inactive
                            </span>
                            {% endif %}
                        </td>
                        <td style="padding: 18px 24px; text-align: right;">
                            <a href="{% url 'admin_edit_user' u.username %}" class="v-btn v-btn-secondary"
                                style="padding: 6px 16px; font-size: 12px; height: 32px;">Manage</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="padding: 40px; text-align: center; color: var(--text-secondary);">No
                            users found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .user-row:hover {
        background: rgba(0, 0, 0, 0.02);
    }
</style>
{% endblock %}